
>转自： https://zhuanlan.zhihu.com/p/43249121 作者表达非常清晰，内容优秀。
### babel做了什么
简单来说就是吧js中es6部分的新语法转换为es5，能够让低端运行环境（浏览器或者node）能够识别并且运行。当然也可以转换为更低版本的规范，但是es5已经几乎覆盖了所有使用环境了，常规的做法也是转换为es5的形式的。

使用方法
>1. 使用单体稳健
>2. 使用命令行
>3. 使用构建工具（webpack）
>这三种使用的方法只是入口的不听，本质上都是调用babel的内核，处理程序都是一样的。

### 大致的运行机制
babel运行分为三个阶段：`解析`，`转换`，`生成`。
babel本身是不具备任何的转换功能的，他`转换`这个功能都下放到了`插件`内，如果没有转换，那么，babel生成的代码将不会有任何变化。
**我们需要关注的点大多时候都在`插件`上**。

### 插件分为两种
#### 1. `语法插件（识别）`
语法插件，就是能够让我们的babel理解更多的语法。例如箭头语法，如果语法插件不支持，不理解箭头函数，那么就是非法的代码。babel会提示语法错误。
#### 2. `转译插件（转换）`
转译插件，就是能够让我们的代码转换为其他格式的代码并且输出，这也是我们最为**核心**的需求。比如箭头函数 `(a) => a` 就会转化为 `function (a) {return a}`。是这个插件的力量`babel-plugin-transform-es2015-arrow-functions`

有些插件可能同时存在语法插件和转译插件，这种时候我们就只需要使用一个即可。

### 怎么使用插件
插件是babel的`核心要义`，需要两步使用
1. 安装需要的插件
2. 将插件名字添加入配置文件内
> 根目录下的`.babelrc`或者`package.json`的`babel`对象内，两者使用方式相同。

### 预设模板（preset）
>我们知道将es6版本往下es5的装换要涉及到大量语法的识别以及转换，我们不可能每次都将全部的语法插件都罗列一遍，然后下载安装。这麻烦不说还特别容易出错。所以我们拥有预设的模板，专有名词`preset`。

为了解决大量插件的安装问题，babel提供了插件的集合，因为非常常用，所以不必重复定义&安装。

***我们可以粗暴的将`preset`理解为`插件`的套餐***
既然我们理解为了套餐，那么我们就可以将preset分为几种套餐模板了。
- #### 官方套餐
- #### stage-x套餐(`包含每年规范的草案，每年更新`)
    - stage 0 只是个想法
    - stage 1 初步尝试
    - stage 2 完成初步规范
    - stage 3 候选了，等待下一代浏览器
    - stage 4 下一年发布

此外，低一级的 `stage` 会包含所有高级 `stage` 的内容，例如 `stage-1` 会包含 `stage-2`, `stage-3`的所有内容。

- #### es201x, lastest
都是已经纳入标准规范的语法。例如 `es2015` 包含 `arrow-functions`。
但因为 env 套餐的出现，使得 es2016 和 es2017 都已经废弃。所以我们经常可以看到 es2015 被单独列出来，但极少看到其他两个。
latest 是 env 的雏形，它是一个每年更新的套餐，目的是包含所有 es6。但也是因为更加灵活的 env 的出现，已经废弃。

### 执行顺序
既然有着单独使用插件和套餐使用插件的区别，那么肯定也有着执行优先级，顺序的问题。

- #### 单独的插件将会优先套餐运行
- #### 单独的插件从前往后执行
- #### preset（套餐）会从后往前执行

> preset 的逆向顺序主要是为了保证向后兼容。因为大多数用户的编写顺序是 ['es2015', 'stage-0']。这样必须先执行 stage-0 才能确保 babel 不报错。因此我们编排 preset 的时候，也要注意顺序，其实只要按照规范的时间顺序列出即可。

### 书写方式
简略情况下，插件和 preset 只要列出字符串格式的名字即可。但如果某个 preset 或者插件需要一些配置项(或者说参数)，就需要把自己先变成数组。第一个元素依然是字符串，表示自己的名字；第二个元素是一个对象，即配置对象。
最需要配置的当属 env，如下：

```js
"presets": [
    [ "env", { "module": false } ],
    "stage-2"
]
```

### 重要preset套餐 `env`详解

env 的核心目的是通过配置得知目标环境的特点，然后只做`必要`的转换。例如目标浏览器支持 `es2015`，那么 `es2015` 这个 `preset`套餐 其实是不需要的，于是代码就可以转换的少一点，构建时间也可以缩短一些。

如果不写任何配置项，env 等价于 latest，也等价于 es2015 + es2016 + es2017 三个相加(不包含 stage-x 中的插件)

以下是常规使用：
```js
// 转化为 考虑所有浏览器最新两个版本，safari大于等于7的版本的特性
// 针对已有的特性，只做必要的转换。
{
  "presets": [
    ["env", {
      "targets": {
        "browsers": ["last 2 versions", "safari >= 7"]
      }
    }]
  ]
}
// 考虑node 6.10 版本的环境，只做必要的转换
{
  "presets": [
    ["env", {
      "targets": {
        "node": "6.10"
      }
    }]
  ]
}

```

以上就是babel的核心奥义，无论是使用何种方式来调用，都需要走这套流程。